<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î 1 ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏° | ‡∏™‡∏ï‡∏£‡∏µ‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f6f9; /* Light background for the whole page */
        }
        .container-card {
            background-color: white;
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Soft shadow */
            padding: 2rem;
        }
        .nav-button {
            transition: all 0.3s ease;
        }
        .nav-button.active {
            border-color: #10B981; /* Emerald green accent */
            color: #10B981;
            background-color: #ECFDF5;
            font-weight: 600;
        }
        .nav-button:not(.active):hover {
            background-color: #F3F4F6;
        }
        .btn-primary {
            background-color: #3B82F6; /* Blue button */
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #2563EB;
        }
        .input-style {
            border-radius: 0.75rem;
            border-color: #D1D5DB;
            padding: 0.75rem 1rem;
            transition: border-color 0.3s ease;
        }
        .input-style:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
    </style>
    <script>
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ URL ‡πÅ‡∏•‡∏∞ ID ‡∏ï‡πà‡∏≤‡∏á‡πÜ
        const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx5Pd97Pb14ajoDC1aUj942_mlrN11mc5lflmo38bW_dKjAnxeiocjutt-RDaW1TjdC/exec';
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        function navigate(page) {
            document.querySelectorAll('.page').forEach(el => el.classList.add('hidden'));
            document.getElementById(page).classList.remove('hidden');
            
            document.querySelectorAll('.nav-button').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + page).classList.add('active');

            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            document.getElementById('upload-form').reset();
            document.getElementById('login-form').reset();
            document.getElementById('check-form').reset();
            document.getElementById('status-message').innerHTML = '';
            document.getElementById('check-result').innerHTML = '';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô Base64
        function getBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]); // ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô base64
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }
        
        // ------------------ 1. ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î ------------------
        async function handleSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const statusDiv = document.getElementById('status-message');
            const saveButton = document.getElementById('save-button');

            statusDiv.className = 'mt-4 p-3 rounded-xl bg-yellow-100 text-yellow-800 text-center';
            statusDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå... ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
            saveButton.disabled = true;

            try {
                const classLevel = form.classLevel.value;
                const classNumber = form.classNumber.value;
                const videoFile = form.videoFile.files[0];
                const posterFile = form.posterFile.files[0];

                if (!classLevel || !classNumber || !videoFile || !posterFile) {
                    throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏Å‡∏≥‡∏´‡∏ô‡∏î)
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á Apps Script ‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤

                const videoBase64 = await getBase64(videoFile);
                const posterBase64 = await getBase64(posterFile);

                const payload = {
                    action: 'submitProject',
                    classLevel: classLevel,
                    classNumber: classNumber,
                    video: videoBase64,
                    videoName: videoFile.name,
                    videoType: videoFile.type,
                    poster: posterBase64,
                    posterName: posterFile.name,
                    posterType: posterFile.type
                };

                const response = await fetch(APP_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Apps Script requires 'no-cors'
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams(payload)
                });
                
                // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ä‡πâ 'no-cors' ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô response.json() ‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏á‡πÜ
                // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Apps Script ‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏µ‡πà redirect ‡∏°‡∏≤

                statusDiv.className = 'mt-4 p-3 rounded-xl bg-green-100 text-green-800 text-center';
                statusDiv.innerHTML = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• 1-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';
                form.reset();

            } catch (error) {
                console.error("Error submitting form:", error);
                statusDiv.className = 'mt-4 p-3 rounded-xl bg-red-100 text-red-800 text-center';
                statusDiv.innerHTML = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}. ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
            } finally {
                saveButton.disabled = false;
            }
        }
        
        // ------------------ 2. ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á ------------------
        async function handleCheck(event) {
            event.preventDefault();
            const form = event.target;
            const resultDiv = document.getElementById('check-result');
            const checkButton = document.getElementById('check-button');

            checkButton.disabled = true;
            resultDiv.innerHTML = '<p class="text-center text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>';
            resultDiv.className = 'mt-4 p-4 rounded-xl bg-blue-50';

            try {
                const classLevel = form.checkClassLevel.value;
                const classNumber = form.checkClassNumber.value;
                
                if (!classLevel || !classNumber) {
                    throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
                }

                const url = new URL(APP_SCRIPT_URL);
                url.searchParams.append('action', 'checkSubmission');
                url.searchParams.append('classLevel', classLevel);
                url.searchParams.append('classNumber', classNumber);

                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'success') {
                    if (data.isSubmitted) {
                        resultDiv.className = 'mt-4 p-4 rounded-xl bg-green-100 text-green-800';
                        resultDiv.innerHTML = `
                            <p class="font-bold text-lg">‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á: ${data.timestamp}</p>
                            <p>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô ${classLevel}/${classNumber} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                        `;
                    } else {
                        resultDiv.className = 'mt-4 p-4 rounded-xl bg-yellow-100 text-yellow-800';
                        resultDiv.innerHTML = `
                            <p class="font-bold text-lg">‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î</p>
                            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                        `;
                    }
                } else {
                    throw new Error(data.message || '‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }

            } catch (error) {
                console.error("Error checking submission:", error);
                resultDiv.className = 'mt-4 p-4 rounded-xl bg-red-100 text-red-800';
                resultDiv.innerHTML = `<p class="font-bold text-lg">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p><p>${error.message}</p>`;
            } finally {
                checkButton.disabled = false;
            }
        }
        
        // ------------------ 3. ‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Login) ------------------
        async function handleLogin(event) {
            event.preventDefault();
            const form = event.target;
            const messageDiv = document.getElementById('login-message');
            const loginButton = document.getElementById('login-button');

            loginButton.disabled = true;
            messageDiv.innerHTML = '<p class="text-center text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...</p>';
            messageDiv.className = 'mt-4 p-2 rounded-xl bg-blue-50';

            try {
                const username = form.username.value;
                const password = form.password.value;

                const url = new URL(APP_SCRIPT_URL);
                url.searchParams.append('action', 'adminLogin');
                url.searchParams.append('username', username);
                url.searchParams.append('password', password);

                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'success') {
                    messageDiv.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
                    messageDiv.className = 'mt-4 p-2 rounded-xl bg-green-100 text-green-800';
                    showAdminPanel(); // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
                } else {
                    throw new Error(data.message || '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }

            } catch (error) {
                console.error("Login error:", error);
                messageDiv.className = 'mt-4 p-2 rounded-xl bg-red-100 text-red-800';
                messageDiv.innerHTML = `‚ùå ${error.message}`;
            } finally {
                loginButton.disabled = false;
            }
        }
        
        // ------------------ 3. ‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Panel) ------------------
        function showAdminPanel() {
            document.getElementById('admin-login').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            fetchSettings();
            fetchSubmissions();
        }
        
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå
        async function fetchSettings() {
            const settingsDiv = document.getElementById('admin-settings');
            settingsDiv.innerHTML = '<p class="text-center text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤...</p>';

            try {
                const url = new URL(APP_SCRIPT_URL);
                url.searchParams.append('action', 'getSettings');

                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'success') {
                    document.getElementById('videoMaxSize').value = data.settings.videoMaxSize / (1024 * 1024);
                    document.getElementById('posterMaxSize').value = data.settings.posterMaxSize / (1024 * 1024);
                    settingsDiv.innerHTML = `
                        <p class="text-green-600">‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                        <p class="text-sm text-gray-500">‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ: ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ${data.settings.videoMaxSize / (1024 * 1024)} MB, ‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå ${data.settings.posterMaxSize / (1024 * 1024)} MB</p>
                    `;
                } else {
                    throw new Error(data.message || '‡∏î‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }
            } catch (error) {
                console.error("Error fetching settings:", error);
                settingsDiv.innerHTML = `<p class="text-red-600">‚ùå ‡∏î‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}</p>`;
            }
        }
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå
        async function saveSettings() {
            const videoSizeMB = document.getElementById('videoMaxSize').value;
            const posterSizeMB = document.getElementById('posterMaxSize').value;
            const settingsDiv = document.getElementById('admin-settings');
            const saveButton = document.getElementById('save-settings-button');
            
            saveButton.disabled = true;
            settingsDiv.innerHTML = '<p class="text-center text-yellow-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤...</p>';

            try {
                const videoMaxSize = videoSizeMB * 1024 * 1024;
                const posterMaxSize = posterSizeMB * 1024 * 1024;
                
                const payload = {
                    action: 'saveSettings',
                    videoMaxSize: videoMaxSize,
                    posterMaxSize: posterMaxSize
                };

                const response = await fetch(APP_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams(payload)
                });
                
                settingsDiv.innerHTML = '<p class="text-center text-green-600">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>';
            } catch (error) {
                console.error("Error saving settings:", error);
                settingsDiv.innerHTML = `<p class="text-red-600">‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}</p>`;
            } finally {
                saveButton.disabled = false;
            }
        }
        
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        async function fetchSubmissions() {
            const tableBody = document.getElementById('submission-table-body');
            const loadingRow = `<tr><td colspan="8" class="text-center py-4 text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>`;
            tableBody.innerHTML = loadingRow;

            try {
                const url = new URL(APP_SCRIPT_URL);
                url.searchParams.append('action', 'getAllSubmissions');

                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'success') {
                    renderSubmissionTable(data.submissions);
                } else {
                    throw new Error(data.message || '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }
            } catch (error) {
                console.error("Error fetching submissions:", error);
                tableBody.innerHTML = `<tr><td colspan="8" class="text-center py-4 text-red-600">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}</td></tr>`;
            }
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function renderSubmissionTable(submissions) {
            const tableBody = document.getElementById('submission-table-body');
            tableBody.innerHTML = '';
            
            if (submissions.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="8" class="text-center py-4 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î</td></tr>`;
                return;
            }

            submissions.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                tr.innerHTML = `
                    <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${index + 1}</td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${row[1]}</td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-900">${row[2]}</td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${row[0]}</td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm">
                        <a href="${row[3]}" target="_blank" class="text-blue-600 hover:text-blue-900 font-medium">‡∏î‡∏π‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</a>
                    </td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm">
                        <a href="${row[4]}" target="_blank" class="text-blue-600 hover:text-blue-900 font-medium">‡∏î‡∏π‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå</a>
                    </td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">
                        <span class="p-1.5 text-xs font-medium uppercase tracking-wider text-green-800 bg-green-200 rounded-lg bg-opacity-50">‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        document.addEventListener('DOMContentLoaded', () => {
            navigate('submission'); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        });
    </script>
</head>
<body class="p-4 md:p-8">

    <header class="mb-8">
        <div class="max-w-4xl mx-auto flex items-center justify-center space-x-4">
            <img src="https://img5.pic.in.th/file/secure-sv1/IMG_25650953161d1c1bbdd8.jpeg" alt="Logo" class="w-16 h-16 object-contain rounded-full shadow-lg">
            <h1 class="text-3xl font-bold text-gray-800 text-center">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î 1 ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°</h1>
        </div>
        
        <div class="max-w-4xl mx-auto mt-6 flex justify-center space-x-3 p-2 bg-white rounded-full shadow-md">
            <button id="nav-submission" onclick="navigate('submission')" class="nav-button flex-1 py-2 px-4 text-gray-600 rounded-full border border-transparent">
                üìù ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î
            </button>
            <button id="nav-check" onclick="navigate('check')" class="nav-button flex-1 py-2 px-4 text-gray-600 rounded-full border border-transparent">
                üîé ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
            </button>
            <button id="nav-admin" onclick="navigate('admin')" class="nav-button flex-1 py-2 px-4 text-gray-600 rounded-full border border-transparent">
                üîë ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
            </button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto">
        
        <div id="submission" class="page container-card">
            <h2 class="text-2xl font-bold mb-6 text-gray-700 border-b pb-2">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡πà‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°</h2>
            <form id="upload-form" onsubmit="handleSubmit(event)">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                    <div>
                        <label for="classLevel" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (‡∏°.) <span class="text-red-500">*</span></label>
                        <select id="classLevel" name="classLevel" required class="input-style w-full border">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                            <option value="‡∏°.1">‡∏°.1</option>
                            <option value="‡∏°.2">‡∏°.2</option>
                            <option value="‡∏°.3">‡∏°.3</option>
                            <option value="‡∏°.4">‡∏°.4</option>
                            <option value="‡∏°.5">‡∏°.5</option>
                            <option value="‡∏°.6">‡∏°.6</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="classNumber" class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (1-12) <span class="text-red-500">*</span></label>
                        <select id="classNumber" name="classNumber" required class="input-style w-full border">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                            <script>
                                for(let i=1; i<=12; i++) {
                                    document.write(`<option value="${i}">${i}</option>`);
                                }
                            </script>
                        </select>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="videoFile" class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô (.mp4) <span class="text-red-500">*</span></label>
                    <input type="file" id="videoFile" name="videoFile" accept="video/mp4" required class="input-style w-full border p-2 bg-gray-50 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="text-xs text-gray-500 mt-1">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</p>
                </div>

                <div class="mb-6">
                    <label for="posterFile" class="block text-sm font-medium text-gray-700 mb-2">‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå (.pdf, .png, .jpg, .jpeg) <span class="text-red-500">*</span></label>
                    <input type="file" id="posterFile" name="posterFile" accept=".pdf,.png,.jpg,.jpeg" required class="input-style w-full border p-2 bg-gray-50 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100">
                    <p class="text-xs text-gray-500 mt-1">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</p>
                </div>

                <div id="status-message" class="hidden" role="alert"></div>

                <button type="submit" id="save-button" class="btn-primary w-full py-3 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition duration-200">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </form>
        </div>

        <div id="check" class="page container-card hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-700 border-b pb-2">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô</h2>
            <form id="check-form" onsubmit="handleCheck(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                    <div>
                        <label for="checkClassLevel" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (‡∏°.)</label>
                        <select id="checkClassLevel" name="checkClassLevel" required class="input-style w-full border">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                            <option value="‡∏°.1">‡∏°.1</option>
                            <option value="‡∏°.2">‡∏°.2</option>
                            <option value="‡∏°.3">‡∏°.3</option>
                            <option value="‡∏°.4">‡∏°.4</option>
                            <option value="‡∏°.5">‡∏°.5</option>
                            <option value="‡∏°.6">‡∏°.6</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="checkClassNumber" class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (1-12)</label>
                        <select id="checkClassNumber" name="checkClassNumber" required class="input-style w-full border">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                            <script>
                                for(let i=1; i<=12; i++) {
                                    document.write(`<option value="${i}">${i}</option>`);
                                }
                            </script>
                        </select>
                    </div>
                </div>
                
                <button type="submit" id="check-button" class="btn-primary w-full py-3 text-white font-bold rounded-xl shadow-lg transition duration-200 mt-4">
                    ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                </button>
            </form>

            <div id="check-result" class="mt-6">
                </div>
        </div>

        <div id="admin" class="page container-card hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-700 border-b pb-2">üîë ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>

            <div id="admin-login">
                <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
                        <input type="text" id="username" name="username" required class="input-style w-full border">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="password" name="password" required class="input-style w-full border">
                    </div>
                    <div id="login-message" class="text-center"></div>
                    <button type="submit" id="login-button" class="btn-primary w-full py-2 text-white font-bold rounded-xl shadow-md">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </form>
            </div>
            
            <div id="admin-panel" class="hidden">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div class="bg-gray-50 p-4 rounded-xl mb-6">
                    <h4 class="font-medium text-gray-600 mb-3">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (MB)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                        <div>
                            <label for="videoMaxSize" class="block text-sm font-medium text-gray-700">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (.mp4)</label>
                            <input type="number" id="videoMaxSize" class="input-style w-full border" value="50" min="1" required>
                        </div>
                        <div>
                            <label for="posterMaxSize" class="block text-sm font-medium text-gray-700">‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå (.pdf/.png/.jpg)</label>
                            <input type="number" id="posterMaxSize" class="input-style w-full border" value="10" min="1" required>
                        </div>
                        <button onclick="saveSettings()" id="save-settings-button" class="btn-primary py-2 text-white font-bold rounded-xl shadow-md">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </button>
                    </div>
                    <div id="admin-settings" class="mt-2 text-sm text-center"></div>
                </div>

                <h3 class="text-xl font-semibold mb-4 text-gray-700">üìÑ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                
                <div class="overflow-x-auto shadow-lg rounded-xl">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏´‡πâ‡∏≠‡∏á</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="submission-table-body" class="bg-white divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
                <button onclick="fetchSubmissions()" class="mt-4 w-full py-2 bg-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-300 transition duration-200">
                    üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>
        </div>
        
    </main>

    <footer class="mt-12 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm">
        copyright &copy; 2024 SPT MORAL SCHOOL - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏° ‡∏™‡∏û‡∏ê. ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏ï‡∏£‡∏µ‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á | All Rights Reserved
    </footer>

</body>
</html>
